<h1>New toy</h1>

<%#= render 'form' %>

<%= form_for @toy do |f| %>
  <%#= f.error_messages %>
  <p>
    <%= f.label :name,"成品名称" %><br />
    <%= f.text_field :name %>
  </p>
<a href="#new" id="new">添加零件包</a>
<%
association=:packages
new_object = f.object.class.reflect_on_association(association).klass.new
new_object.parts.build
    fields = f.fields_for(association, new_object, :child_index => "new_#{association}") do |builder|
      render(association.to_s.singularize + "_fields", :f => builder)
    end
%>
<SCRIPT TYPE="text/javascript">
$("a#new").on( "click", function( event ) {
  size=$("ul#myTab li").size()+1;
  $("ul#myTab").append("<li><a href='#n"+size+"' data-toggle='tab'>新零件包"+size+"</a></li>");
  $("div.tab-content").append("<div class='tab-pane ' id='n"+size+"'><%= escape_javascript(fields) %> </div>");
  $('#myTab a:last').tab('show');
});

</SCRIPT>
<div class="tabbable tabs-left">
    <ul class="nav nav-tabs " id="myTab">
      <% n=0 %>
      <%= f.fields_for :packages do |builder| %>
      <% n+=1 %>
      <li class="<%= 'active' if n==1 %>">
        <a href="#n<%= n %>">新零件包<%= n %></a>
      </li>
      <% end %>
      
    </ul>
    <div class="tab-content">
      <% p=0 %>
      <%= f.fields_for :packages do |builder| %>
      <% p+=1 %>
      <div class="tab-pane <%= 'active' if p==1 %>" id="n<%= p %>">    
        
      <%= render 'package_fields', :f => builder %>
      </div>
      <% end %>
    </div>
     
</div>
  
  <p><%= f.submit "Submit" %></p>
<% end %>

<%= link_to 'Back', toys_path %>

<div id="part-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">零件</h3>
  </div>
  <div class="modal-body">

  </div>

</div>


