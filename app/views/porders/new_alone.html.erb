<div class="contentwrapper"><!--Content wrapper-->
  <%= render '/share/head',:title=>'生产管理',:here=>'独立生产下单' %>

  <div class="row-fluid">
    <div class="span12" id="msg">
      <%= notice_message %>
    </div>
  </div> 

  <div class="row-fluid">
    <div class="span12">
      <div class="box">
        <div class="title">
          <h4>
            <span class="icon16 brocco-icon-grid"></span>
            <span>独立生产下单</span>
          </h4>
          
        </div>
        <div class="content noPad">
          <div style="padding: 15px;height:30px;">
            
            <%= form_for(@porder,:html=>{:class=>""} ) do |f| %>
              
                <%= f.hidden_field :quantity,:value=>1 %>
                
                <button type="submit" class="btn btn-success">下单</button>
              
            
            
            <script type="text/javascript">
            	$("a#js").on( "click", function( event ) {

                var q=$("input#porder_quantity").val();
                var zs=0;
                var kc=0;
                var ky=0;
                var wait_for_out=0;
            		$("tbody#parts tr").each(function(index){
                  zs=parseInt($(this).find("#sl").text())*q;
                  kc=parseInt($(this).find("#kc").text());
                  wait_for_out=parseInt($(this).find("#wait_for_out").text());
                  ky=kc-zs-wait_for_out;
                  if(ky<=0){
                    $(this).children("#ky").text(ky);
                  }else{
                    $(this).children("#ky").text('');
                  }
                  ;
            			$(this).children("#zs").text(parseInt($(this).find("#sl").text())*q);
                  $(this).children("#zzl").text( Math.round(parseInt($(this).find("#sl").text())*q*parseFloat($(this).find("#zl").text())*100)/100 );
            		}) ;

            	}
            	)
            </script>

          </div>
          
          <table id="DataTables_Table_0" class="responsive table table-bordered ">
            <thead>
              <tr>
                      
                <th>零件编号</th>                         
                
                <th>件数</th>
                <th>重量</td>
                <th>库存</th>
                <th>等待出库</th>
                <th>库存不足</th>
              </tr>
            </thead>
            <tbody id="parts">
              <%= f.fields_for :porder_items do |builder| %>
              <tr>
                <td>
                  <%= builder.text_field :spec_bh %>
                </td>
                <td>
                  <%= builder.text_field :quantity %>
                </td>
              </tr>
              <% end %>
            </tbody>
          </table>


          <% end %>
          <div class="row-fluid" style="padding: 10px;">
            
              
            </div>
                        
          </div>
          
          
        </div>

      </div><!-- End .box -->

    </div>

  </div>

</div>
