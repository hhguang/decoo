<div class="contentwrapper"><!--Content wrapper-->
  <%= render '/share/head',:title=>'生产管理',:here=>'生产下单' %>

  <div class="row-fluid">
    <div class="span12" id="msg">
      <%= notice_message %>
    </div>
  </div> 

  <div class="row-fluid">
    <div class="span12">
      <div class="box">
        <div class="title">
          <h4>
            <span class="icon16 brocco-icon-grid"></span>
            <span>生产下单</span>
          </h4>
          
        </div>
        <div class="content noPad">
          <div style="padding: 15px;">
            
            <%= form_for(@porder,:html=>{:class=>"form-inline pull-left"} ) do |f| %>
              
                <span>
                  成品名称：<%= @toy.name %>
                </span>
                <%= f.label :quantity,"数量" %>        
                <%= f.text_field :quantity %>
                <%= f.hidden_field :toy_id %>
                <a  class="btn" href="#" id='js'>计算</a>
                <button type="submit" class="btn btn-success">下单</button>
              
            <% end %>
            
            <script type="text/javascript">
            	$("a#js").on( "click", function( event ) {

                var q=$("input#porder_quantity").val();
            		$("tbody#parts tr").each(function(index){
            			$(this).children("#zs").text(parseInt($(this).find("#sl").text())*q);
                  $(this).children("#zzl").text( Math.round(parseInt($(this).find("#sl").text())*q*parseFloat($(this).find("#zl").text())*100)/100 );
            		}) ;

            	}
            	)
            </script>

          </div>
          <table id="DataTables_Table_0" class="responsive table table-bordered ">
            <thead>
              <tr>
                <th>#</th>
                <th>单个重量</th>
                <th>数量</th>
                <th>总件数</th>
                <th>总重量</td>
                <th>库存</th>
              </tr>
            </thead>
            <tbody id="parts">
              <% @parts.each do |part| %>
              <tr>
              	
              	<td>
              		<%= part.spec.bh %>
              	</td>
                <td id="zl">
                  <%= part.spec.product.weight || "未知" %>
                </td>
              	<td id="sl">
              		<%= part.quantity %>
              	</td>
              	<td id='zs'>
              		<%= part.quantity*@quantity %>
              	</td>
              	<td id="zzl">
              		<%= part.spec.product.weight.nil? ? "未知" : number_with_precision(part.quantity*@quantity*part.spec.product.weight) %>
              	</td>
              	<td>
              		<%= part.spec.stock.nil? ? 0 : part.spec.stock.quantity %>
              	</td>
              </tr>
              <% end %>
            </tbody>
          </table>

          <div class="row-fluid" style="padding: 10px;">
            
              
            </div>
                        
          </div>
          
          
        </div>

      </div><!-- End .box -->

    </div>

  </div>

</div>
