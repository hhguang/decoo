# encoding: utf-8
<div class="contentwrapper"><!--Content wrapper-->
  <div class="heading">

    <h3>零件管理</h3>



    <ul class="breadcrumb">
      <li>You are here:</li>
      <li>
        <a href="#" class="tip" title="back to dashboard">
          <span class="icon16 icomoon-icon-screen"></span>
        </a>
        <span class="divider">
          <span class="icon16 icomoon-icon-arrow-right"></span>
        </span>
      </li>
      <li class="active">零件管理</li>
    </ul>

  </div><!-- End .heading-->

  <div class="row-fluid">
    <div class="span12">
      <%= notice_message %>
    </div>
  </div>

  
  

    <div class="row-fluid">
      <div class="span12">
        <div class="box">
          <div class="title">
            <h4>
              <span class="icon16 brocco-icon-grid"></span>
              <span>零件列表</span>

  <%#*<form action="" class="box-form right">%>
  <%#*<a href="#" data-toggle="dropdown" class="btn dropdown-toggle">%>
  <%#*<span class="icon16 iconic-icon-cog"></span>%>
  <%#*<span class="caret"></span>%>
  <%#*</a>%>
  <%#*<ul class="dropdown-menu">%>
  <%#*<li><a href="#"><span class="icon-plus"></span> 增加</a></li>%>
  <%#*<li><a href="#"><span class="icon-trash"></span> 删除</a></li>%>
  <%#*</ul>%>
  <%#*</form>%>

            </h4>
            <a class="minimize" href="#" style="display: none;">Minimize</a>
          </div>
          <div class="content noPad">
            <div style="padding: 15px;">
              <a href="#new-modal" role="button"  class="btn btn-success " data-toggle="modal">
                <span class="icon14 iconic-icon-plus white"></span>
                新增零件
              </a>

              <form class="form-inline pull-right" style="padding-left:20px;" action="<%=  products_path %>">
                <input type="text" class="input-medium search-query" name="search"/>
                <button type="submit" class="btn">搜索</button>
              </form>

            </div>
            <table id="DataTables_Table_0" class="responsive table table-bordered ">
              <thead>
                <tr>
                  <th>#</th>
                  <th>图片</th>
                  <th >编号
                    <a href="<%= products_path %>/?order=bh&search=<%= @search %>" class="icon-arrow-up">
                    </a>
                    <a href='<%= "#{products_path}/?order=bh desc&search=#{@search}" %>' class="icon-arrow-down">
                    </a>
                  </th>
                  <th>名称</th>
                  <th>重量</th>
                  <th>规格</th>
                  <th>时间
                    <a href="<%= products_path %>/?order=created_at&search=<%= @search %>" class="icon-arrow-up">
                    </a>
                    <a href='<%= "#{products_path}/?order=created_at desc&search=#{@search}" %>' class="icon-arrow-down">
                    </a>
                  </th>
 
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="products">


                <% @products.each do |product| %>
                  <tr id="product_<%= product.id %>">
                    <td><%= product.id %></td>
                    <td>
                      <a title="<%= product.title %>" rel="prettyPhoto" href="/products/<%= product.image_url %>">
                        <img src="/products/<%= product.image_url %>" class="img-polaroid" style="width:auto;height: 60px;"/>
                      </a>
                    </td>
                    <td><%= product.bh %></td>
                    <td><%= product.title %></td>

                    <td><%= product.weight.to_f if product.weight %></td>
                    <td>
                      <span id="count-spec-<%= product.id %>">
                      <%= product.specs.size %>
                        </span>
                      <span id="show-specs-<%= product.id %>">
                      <%= link_to '展开',product_specs_path(product),:class=>"icomoon-icon-arrow-down",:remote=>true %>
                        </span>
                      <span id="hide-specs-<%= product.id %>" style="display: none;">
                        <a href="#" class="icomoon-icon-arrow-up" onclick="$('#spec-<%= product.id %>').hide();$('#hide-specs-<%= product.id %>').hide();$('#show-specs-<%= product.id %>').show();return;">收缩</a>
                        </span>
                      <%= link_to '增加',new_product_spec_path(product),:class=>"icomoon-icon-plus-2",:remote=>true %>
                      <div id="spec-<%= product.id %>" style="display: none;"></div>
                    </td>
                    <td>
                      <%= product.created_at.to_s(:db) %>
                    </td>
                    <td>
                      <div class="controls center">
                        <a data-toggle="modal" href="#detail_modal" data-target="#detail_modal" data-remote="<%= product_url(product) %>" class="icon brocco-icon-eye" title="查看产品详细信息"></a>
                        <a data-toggle="modal" href="#edit_modal" data-target="#edit_modal" data-remote="<%= edit_product_url(product) %>" class="icon icomoon-icon-pencil" title="编辑零件"></a>
                        <%#= link_to "",product_specs_path(product),:class=>"brocco-icon-star-2",:title=>"编辑规格" %>
                        <%= link_to "", product, :class => "icon icomoon-icon-remove",'data-confirm' => "确定要删除吗？", :method => :delete, :title => "确定要删除吗？" %>

                      </div>
                    </td>

                  </tr>
                <% end %>
              </tbody>
            </table>
            <div style="padding: 10px;">
              
              <div class="pull-left" >
              <form class="form-inline pull-right" style="padding-left:20px;padding-right: 10px;" action="<%= "#{products_path}" %>" >
                <input type="text" class="input-medium" name="page"/>
                <input type="hidden" name="order" value="<%= @order %>"></input>
                <input type="hidden" name="search" value="<%= @search %>"></input>
                <button type="submit" class="btn">跳转</button>
              </form>
                </div>
              <%= will_paginate @products, :inner_window => 2,:params=>{:search=>@search,:order=>@order} %>
            </div>
          </div>

        </div><!-- End .box -->

      </div>

    </div>
  </div>

  <div id="new-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel">新增零件</h3>
    </div>
    <div class="modal-body">
      <%= form_for(@product, :html=>{:class=>'form-horizontal',:multipart=>true},:remote=>true) do |f| %>
        <% if @product.errors.any? %>
          <div id="error_explanation">
            <h2><%= pluralize(@product.errors.count, "error") %> prohibited this product from being saved:</h2>

            <ul>
              <% @product.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>
        <div class="form-row row-fluid">
          <div class="span12">
            <div class="row-fluid">
              <label for="title" class="form-label span4">名称</label>
              <%= f.text_field :title,:class=>'span8 focused text' %>
            </div>
          </div>
        </div>
        <div class="form-row row-fluid">
          <div class="span12">
            <div class="row-fluid">
              <label for="bh" class="form-label span4">编号</label>
              <%= f.text_field :bh,:class=>'span8 focused text' %>
            </div>
          </div>
        </div>
        <div class="form-row row-fluid">
          <div class="span12">
            <div class="row-fluid">
              <label for="weight" class="form-label span4">重量</label>
              <%= f.text_field :weight,:class=>'span8 focused text' %>
            </div>
          </div>
        </div>
        <div class="form-row row-fluid">
          <div class="span12">
            <div class="row-fluid">
              <label for="weight" class="form-label span4">备注</label>
              <%= f.text_area :memo,:class=>'span8 uniform',:rows=>3 %>
            </div>
          </div>
        </div>
        <div class="form-row row-fluid">
          <div class="span12">
            <div class="row-fluid">
              <label class="form-label span4">上传文件：</label>
              <%#*<input type="file" name="product[upload_picture]" class='span8 focused text'></input>%>
              <input type="hidden" name="product[image_url]" id="image-url" />
              <img src="" class="img-polaroid" style="width:auto;height: 60px;" id="product-image"/>

              <%= link_to("点击上传", "#", :id => "topic_add_image", :rel => "twipsy", :class => "icon eco-images ")%>
            </div>
          </div>
        </div>
      <div style="display:none;">
    <form >
      <input type="file" id="topic_upload_images"/>
    </form>
</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-info" type="submit" onclick="$('#new-modal').modal('hide')">保存</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">取消</button>

      </div>
    <% end %>
  </div>

  <div id="detail_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel">零件详细信息</h3>
    </div>
    <div class="modal-body">
      
    </div>

    <div class="modal-footer">

      <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>

    </div>
  </div>
<div id="edit_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel">零件信息编辑</h3>
    </div>
    <div class="modal-body">

    </div>
   
  </div>
<div id="edit-spec-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel">规格编辑</h3>
    </div>
    <div class="modal-body">

    </div>

  </div>
<div id="new-spec-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel">编辑规格</h3>
    </div>
    <div class="modal-body">

    </div>

  </div>
  <script type="text/javascript">
    $('body').on('hidden', '.modal', function () {
      $(this).removeData('modal');
    });
  </script>
